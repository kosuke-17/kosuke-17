## コンピューティングの基礎

- CPU
  - 実行と処理を担う中核
- RAM
  - Random Access Memory
  - 一時的にデータを保存するためのパーツ
- ハードドライブ
  - 長期的にデータを保存するための場所
- ネットワークパフォーマンス

  - 帯域幅
    - 一定の時間枠に送信可能なデータの量
  - レイテンシー

    - データの移動にかかる時間

  - すべてのコンピュータは OS を有している

    - ハードウェアやソフトウェアを管理する
    - Microsoft Windows, Linux, MacOS など

  - クラウドコンピューティングの利点
    - コスト削減
      - 前払い料金なし
      - 従量課金制
      - データセンターが不要
    - スケーラブル
      - ニーズに応じてスケールアップまたはスケールダウン
      - 必要に応じてリソースをプロビジョニング
    - 信頼性
      - アプリケーション統合性
      - 耐障害性設計
        - https://journey.prog-8.com/ja/scenes/continuous-delivery/skills/fault-tolerance/

## EC2 の基礎

- EC2 で解決される課題

  - オンプレと比較したときに、使っていない不要なリソースは停止や削除することで利用金額の調整を行うことができる
  - 実際にサーバーを持たずにブラウザ上で完結するので作業効率がオンプレよりも高くなる

- EC2 の概要

  -

- EC2 アーキテクチャコンポーネント

  - リージョン
    - EC2 インスタンスをプロビジョンするリージョンを指定する必要がある
    - 他リージョンから分離されるように設計されているため、耐障害性と安全性が確保されている
    - インスタンス起動時はレイテンシーを排除するため、ユーザーから最寄りのリージョンを選択することが望ましい
      - [ネットワークレイテンシーとは、データのパケットが送信元から送信先に移動するまでにかかる時間](https://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/ena-improve-network-latency-linux.html)
  - VPC

    - AWS リソースを起動できるサービス
    - EC2 は選択した VPC 内で起動される
    - 複数の VPC を 1 つのリージョン内で作成できる
      - 本番用 VPC と開発用 VPC、テスト用 VPC

  - サブネット
    - VPC 内で EC2 インスタンスを配置するサブネットを指定する
    - インターネットに接続する必要があるリソースはパブリックサブネットを使用、必要がない場合はプライベートサブネットを使用
    - サブネットは 1 つのアベイラビリティゾーンにのみ関連付けられる
  - セキュリティグループ
    - EC2 インスタンス起動するときに、インスタンス設定中に選択したセキュリティーグループによって保護される
    - 仮想ファイアウォールとして機能

- 高可用性、耐障害性のあるアプリケーションを構築するのが望ましい

  - ELB をアタッチするなどして、1 つ以上の AZ にある複数のターゲットと仮想インスタンスにおいて、アプリケーションが受け取るトラフィックを自動的に分散させる

  - EC2 のユースケース
    - クラウドネイティブおよびエンタープライズアプリケーションの実行
    - ハイパフォーマンスアプリケーションのスケーリング
    - Apple プラットフォームに対する開発
    - 機械学習アプリのトレーニングとデプロイ

## インスタンスコスト

- インスタンス購入オプション
  - オンデマンドインスタンス
    - 特徴
      - 秒単位または時間ごとに料金を払う
      - 長期契約が不要
      - 前払いなし
      - アプリのニーズに応じて性能を増減
    - ユースケース
      - 短期的な急増する予測不能なワークロード
      - アプリの開発やテスト
    - 解決される課題
      - 差し迫ったコンピューティング性能のニー時を解決
  - リーザブドインスタンス
    - 特徴
      - オンデマンドインスタンスに比べて割引が効く
      - 容量に応じて前払い
        - 3 つの前払い方法
    - ユースケース
      - 処理能力に柔軟性を必要としない、予測可能なワークロードに使用
        - 1 年以上続くワークロード
    - 解決される課題
      - 事前に要領をリザーブする機能でコストを削減
  - Saving Plans Instances
    - 特徴
      - 柔軟性が高く、コスト削減につながる
      - 特定のリージョンの特定のインスタンスファミリーに適用される
    - ユースケース
      - 長期ワークロード
    - 解決される課題
      - RI の購入を調節する必要がない
  - スポットインスタンス
    - 特徴
      - 使用されていない EC2 容量を購入
      - オンデマンド料金と比べて最大 90%割引
      - 需要と供給に基づいて AWS が管理する
    - ユースケース
      - 開始および終了時間が柔軟なアプリケーション
    - 解決される課題
      - 低予算のワークロードを、中断を許容できることを前提として、低コストのインスタンスで補完
- テナンシー
  - EC2 インスタンスが物理的なホストハードウェアに分散される方法を定義

## EC2 の使用

- ステップ 1
  - タグの使用
    - AWS リソースに割り当てられるラベル
    - キーと任意の値で構成される
    - インスタンスの名前がデフォルトのタグ
    - タグ付けの利点
      - リソースの一元管理
        - Resource Groups サービスと Tag Editor を使用すると、複数のサービス、リソース、リージョンで構成されているアプリケーションを１か所に統合して表示
      - コスト管理
        - Cost Explorer と詳細な請求レポートを使用して、タグによるコストの分割ができる
      - オートメーション
      - アクセスコントロール
    - タグの機能
      - 管理
        - 1 つにつき 50 個の制限
      - 検索とフィルター
        - キーまたはタグによるリソース検索
- ステップ 2
  - Amazon Machine Image の選択
    - ルートボリュームのテンプレート
      - OS
      - アプリケーションサーバー
      - アプリケーション
    - 起動許可でどの AMI が使用できるかを管理
    - ブロックデバイスマッピングでインスタンスの起動時にインスタンスにアタッチするボリュームを指定
    - インスタンス作成後には AMI は変更できないので、どのようなインスタンスが使用されるか完全に理解する必要がある
    - AMI の利点
      - 再現性
      - 再利用可能
      - 復元可能性
      - Marketplace のソリューション
      - バックアップ
- ステップ 3
  - インスタンスタイプ
    - CPU(処理能力)
    - RAM(メモリ)
    - ディスク容量とディスクタイプ
    - ネットワークパフォーマンス
  - インスタンスファミリー
    - インスタンスのグループで、設定が変化し、同じコンピューティング、メモリ、ストレージ機能をベースとしている
  - インスタンプタイプの命名
    - t: ファミリーの名前
    - 3: 世代数
    - large: インスタンスサイズ
  - インスタンスカテゴリ
    - 汎用
    - コンピューティング最適化
    - メモリ最適化
    - 高速コンピューティング
    - ストレージ最適化
  - インスタンスの垂直スケーリング
    - インスタンスタイプはインスタンス起動後に変更できる
- ステップ 4
  - キーペア
    - キーペアを使用して、セキュアにインスタンスに接続
      - Linux AMI はプライベートキーを使用し、Secure Shell(SSH)を経由してセキュアにインスタンスに接続する
- ステップ 5
  - ネットワーク設定
    - PVC
    - サブネット
    - セキュリティグループ
      - インスタンスの仮想ファイヤウォール
      - インスタンスにアクセス許可されたトラックをフィルター
      - コンポーネントのルール
        - type
          - ネットワークトラフィックを開くプロトコルのタイプを選ぶ
        - protcol
          - コンピュータやインターネット上の他のサービスが情報を送り合えるようにできる各種の手段のこと
          - 一般的なプロトコルは TCP、UDP、ICMP
        - port range
          - 各プロトコルタイプに対して、トラフィック通過を許可されたポートを検証
        - source
          - 送信元(インバウンドルール)またはトラフィックが到着する送信先(アウトバウンドルール)を選択できる
          - インバウンドルール
            - セキュリティグループを作成するときには、インバウンドルールはない
            - インバウンドルールをセキュリティグループに追加するまで、別のホストからインスタンスに送信されるインバウンドトラフィックは許可されない
          - アウトバウンドルール
            - デフォルトでは、セキュリティグループにはすべてのアウトバウンドトラフィックを許可するアウトバウンドルールが含まれている
            - そのルールを削除し、任意の発信トラフィックのみを許可するアウトバウンドルールを追加できる
          - サブネットレベルではなく、インスタンスレベルで動作
          - 同じサブネットないのインスタンスは、異なるセキュリティグループに割り当てることができる
          - 特定のインスタンスに 1 つ以上のセキュリティグループをアタッチすることが可能
            - インスタンス固有のセキュリティグループが推奨されてる
- ステップ 6
  - ストレージの設定
    - EBS の機能
      - DB 実行
      - ホストアプリケーション
      - ほとんどのストレージコンピューティングに対処
    - ソリッドステートドライブ(SSD)ベース
      - 汎用
      - プロビジョンド IOPS
    - ハードディスクドライブ(HDD)ベース
      - スループット最適化
      - コールド
    - ファイルシステムの追加
      - Elasitic File System
        - 複数の EC2 インスタンスでファイルを共有できるファイルシステム
        - ユーザーがファイルを追加/削除するたびに自動的に拡大縮小する
- ステップ 7

  - AWS サービスで IAM ロールを使用
    - ロールを使用することで AWS サービスへアクセスする権限をインスタンスに付与しながら、セキュリティリスクを克服できる

- 設定に関する検討事項
  - デフォルト設定なし
    - キーペア
  - コストに影響
    - AMI
    - インスタンスタイプ
    - ストレージの設定
    - 高度な詳細
    - リージョン
  - インスタンス起動後に変更不可
    - AMI
    - キーペア
    - ネットワーク設定
      - VPC
      - サブネット
    - リージョン
  - インスタンス起動後に変更可
    - 名前とタグ
    - インスタンスタイプ
    - ネットワーク設定
      - IP アドレス
      - セキュリティグループ
    - ストレージ
    - 高度な詳細
      - ロールの追加
      - ユーザーデータスクリプト
- アクティビティ: ユースケースに基づくインスタンスの設定
  - 名前とタグ
    - インスタンスのリソースはコストに対してレポート可能であるべき
    - インスタンス実行コストは可能な限り低く抑えるべき
      - タグづけをしてレポートを実行し、個別のインスタンスの月々のコストに関するインサイトを得る
  - AMI
    - windows の OS が必要
    - インスタンス実行コストは可能な限り低く抑えるべき

## EC2 の管理

- EC2 インスタンス起動オプション

  - AWS マネジメントコンソール
  - AWS CLI
  - AWS SDK
  - AWS のその他のサービス

  - 垂直スケーリング
  - 水平スケーリング

  - Auto Scaling
    - 指定された条件に基づき、インスタンスの作成および削除される
      - スケジュールに基づくスケーリング
      - 動的スケーリング
      - 予測スケーリング
    - 指定に基づき、ロードバランサーを使用して新インスタンスを自動的に登録する
    - 異常なインスタンスやアクセス不能なインスタンスを新しいインスタンスに置き換える
    -

- Elastic Load Balancing
  - ELB オプション
    - Application Load Balancer
      - HTTP および HTTPS トラフィックのロードバランシングに適している
    - Network load Balancer
      - TCP トラフィックと UDP トラフィックのロードバランシングに理想的
      - アプリケーションに極めて高いパフォーマンスと静的 IP アドレスが必要なとき
    - Gateway load Balancer
      - サードパーティの仮想アプライアンスのデプロイ、スケール、管理に使用できる
