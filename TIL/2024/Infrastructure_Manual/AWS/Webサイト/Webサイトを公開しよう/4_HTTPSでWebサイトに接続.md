# 4 HTTPS で Web サイトに接続

## 4.1 証明書の作成

- CloudFront 用の証明書はバージニアリージョンで作成しなければいけない

### 4.1.1 CloudFront 用の証明書を作成する

- ACM(AWS Certificate Manager) に移動してバージニアリージョンに切り替え
- test.com 用の証明書を作成
  - 完全修飾ドメイン名
    - `test.com`
  - `それ以外の項目はそのままでリクエストボタンをクリック`

## 4.2 CloudFront を構成する

### 4.2.1 CloudFront に移動

### 4.2.2 distribution の作成

- オリジン
  - `test.com...`
    - 「web サイトのエンドポイントを使用」をクリックする
    - 上記のボタンをクリックしないと s3 の static なサイトのエンドポイントにならないので注意
- オリジンアクセス
  - 「Origin access conrtol settings」を選択すると CloudFront を通さずにアクセスできないようにセキュリティポリシーを変更できる
  - 今回は難易度を上げないため`「Public」を選択`
- オリジンシールドを有効にする
  - `無効にしておく`
  - オリジンサーバー(今回は S3)への負荷を軽減する機能を有効にするか決める
- デフォルトキャッシュビヘイビア
  - キャッシュの持続時間などの振る舞いを操作
  - 多くの場合はそのままで問題ない
- WAF
  - 料金かかってしまうので、今回は有効にしない
  - ここで WAF をかけるのが最強らしい(浜口さん情報)
- 料金クラス
  - 適用範囲が広いほど費用がかかる
  - 費用が気になる場合は範囲を狭める
- 代替ドメイン名(CNAMEs)
  - ドメイン名の別名を入力
  - `test.com`
- カスタム SSL 証明書
  - `Certificate Manager で作成したものを選択`
- そのほかはそのままで distribution を作成をクリック

## 4.3 CloudFront にドメイン名でアクセスできるようにする

### 4.3.1 Route53 のホストゾーンに移動

### 4.3.2 レコード名が test.com の項目を開く

- エイリアスが S3 から CloudFront に向くように修正する

  - S3 バケットには 2 つの URL がある
    - 1 つめは AWS の機能を使ってファイル操作するときに使う URL で権限があればファイルアップロードや削除ができる
    - 2 つめは静的 web ホスティングを有効にしたときに限って追加で設定される web ブラウザからの参照専用の URL

- `https://test.com`でアクセスできたら終了
