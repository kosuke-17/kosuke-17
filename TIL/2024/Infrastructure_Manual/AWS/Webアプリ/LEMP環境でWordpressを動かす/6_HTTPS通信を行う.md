# 6 HTTPS 通信を行う

## 6.1 証明書の作成

### 6.1.1 ロードバランサー用の証明書作成

- 東京リージョンに切り替える
- パブリック証明書のリクエストを始める

- 申請情報の入力

  - ドメイン名
    - `blogs.awsexample0123.com`
  - 検証方法
    - `DNS検証`
  - キーアルゴリズム
    - RSA 2048

- 検証の追加設定をする
  - 「証明書設定を表示」をクリック
- CNAME レコードを追加
  - Route53 でレコードを作成
  - レコードを作成
  - DNS レコードが作成される

## 6.2 ロードバランサーを構成

### 6.2.1 ロードバランサーを作成

- 種類
  - ALB
- 基本的な設定
  - ロードバランサー名
    - myalb
  - スキーム
    - インターネット向け
  - IP アドレスタイプ
    - IPv4
- ネットワークマッピング
  - az を 2 つ以上選択
- セキュリティグループ
  - 443 ポートを開ける SG を作成または既存の SG を割り当てる
- リスナーとルーティング
  - リスナーの構成
    - プロトコル
      - HTTPS
    - ポート
      - 443
    - ターゲットグループ
      - 既存があれば割り当てる
      - なければ新規作成
      - グループの詳細の指定
        - インスタンス
        - ターゲットグループ名
          - mytargets
        - 使用可能なインスタンスの配下に含めたいインスタンスにチェック
          - ポート 80 と入力(wp 側で 80 で受け付けているため)
- セキュアリスナーの設定
  - セキュリティポリシー
    - デフォルトのまま
  - デフォルト SSL/TLS サーバー証明書
    - 作成した SCM から選択
- 確認してロードバランサーを作成

## 6.3 ドメイン名でロードバランサーにアクセスできるようにする

### 6.3.1

- blogs.awsexample0123.com がロードバランサーを指すように変更
- Route53 のホストゾーンで A レコードのトラフィックのルーティング先を先ほど作成した ALB を選択
- レイアウト崩れが起きていたら以下のファイルを以下のように編集

```php
<?php
define('WP_HOME', 'https://blogs.awsexample0123.com/');
define('WP_SITEURL', 'https://blogs.awsexample0123.com/');
$_SERVER['HTTPS'] = 'on';
```
